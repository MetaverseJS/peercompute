(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PPlaintext = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PPlaintext=(()=>{var Dr=Object.defineProperty;var Di=Object.getOwnPropertyDescriptor;var Ri=Object.getOwnPropertyNames;var Ti=Object.prototype.hasOwnProperty;var ft=(e,t)=>{for(var r in t)Dr(e,r,{get:t[r],enumerable:!0})},Ki=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ri(t))!Ti.call(e,o)&&o!==r&&Dr(e,o,{get:()=>t[o],enumerable:!(n=Di(t,o))||n.enumerable});return e};var Ci=e=>Ki(Dr({},"__esModule",{value:!0}),e);var bu={};ft(bu,{plaintext:()=>yu});var Je=class extends Error{static name="UnexpectedPeerError";constructor(t="Unexpected Peer"){super(t),this.name="UnexpectedPeerError"}},_e=class extends Error{static name="InvalidCryptoExchangeError";constructor(t="Invalid crypto exchange"){super(t),this.name="InvalidCryptoExchangeError"}},G=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},se=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var ie=class extends Error{static name="ProtocolError";constructor(t="Protocol error"){super(t),this.name="ProtocolError"}};var De=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var Rr=Symbol.for("@libp2p/peer-id");var Eo=Symbol.for("@libp2p/service-capabilities"),Eu=Symbol.for("@libp2p/service-dependencies");var Nr={};ft(Nr,{base58btc:()=>X,base58flickr:()=>qi});var Gu=new Uint8Array(0);function So(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function It(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function vo(e){return new TextEncoder().encode(e)}function Ao(e){return new TextDecoder().decode(e)}function Ui(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var B=0,v=0,b=0,A=d.length;b!==A&&d[b]===0;)b++,B++;for(var g=(A-b)*l+1>>>0,I=new Uint8Array(g);b!==A;){for(var C=d[b],k=0,O=g-1;(C!==0||k<v)&&O!==-1;O--,k++)C+=256*I[O]>>>0,I[O]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,b++}for(var E=g-v;E!==g&&I[E]===0;)E++;for(var w=c.repeat(B);E<g;++E)w+=e.charAt(I[E]);return w}function x(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var B=0;if(d[B]!==" "){for(var v=0,b=0;d[B]===c;)v++,B++;for(var A=(d.length-B)*u+1>>>0,g=new Uint8Array(A);d[B];){var I=r[d.charCodeAt(B)];if(I===255)return;for(var C=0,k=A-1;(I!==0||C<b)&&k!==-1;k--,C++)I+=a*g[k]>>>0,g[k]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");b=C,B++}if(d[B]!==" "){for(var O=A-b;O!==A&&g[O]===0;)O++;for(var E=new Uint8Array(v+(A-O)),w=v;O!==A;)E[w++]=g[O++];return E}}}function y(d){var B=x(d);if(B)return B;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:x,decode:y}}var Ni=Ui,Pi=Ni,Io=Pi;var Tr=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Kr=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Lo(this,t)}},Cr=class{decoders;constructor(t){this.decoders=t}or(t){return Lo(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Lo(e,t){return new Cr({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var Ur=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Tr(t,r,n),this.decoder=new Kr(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function ae({name:e,prefix:t,encode:r,decode:n}){return new Ur(e,t,r,n)}function Nt({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=Io(r,e);return ae({prefix:t,name:e,encode:n,decode:s=>It(o(s))})}function ki(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,a=0,c=0;for(let u=0;u<o;++u){let l=t[e[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<r|l,i+=r,i>=8&&(i-=8,s[c++]=255&a>>i)}if(i>=r||(255&a<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function Oi(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],i+=8;i>r;)i-=r,s+=t[o&a>>i];if(i!==0&&(s+=t[o&a<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function Mi(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function Y({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=Mi(n);return ae({prefix:t,name:e,encode(s){return Oi(s,n,r)},decode(s){return ki(s,o,r,e)}})}var X=Nt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),qi=Nt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Pr={};ft(Pr,{base32:()=>ce,base32hex:()=>Zi,base32hexpad:()=>ji,base32hexpadupper:()=>Gi,base32hexupper:()=>zi,base32pad:()=>Vi,base32padupper:()=>Fi,base32upper:()=>Hi,base32z:()=>Yi});var ce=Y({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Hi=Y({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Vi=Y({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Fi=Y({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Zi=Y({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),zi=Y({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ji=Y({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Gi=Y({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Yi=Y({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var kr={};ft(kr,{base36:()=>Re,base36upper:()=>$i});var Re=Nt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),$i=Nt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Xi=Ro,_o=128,Wi=127,Ji=~Wi,Qi=Math.pow(2,31);function Ro(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Qi;)t[r++]=e&255|_o,e/=128;for(;e&Ji;)t[r++]=e&255|_o,e>>>=7;return t[r]=e|0,Ro.bytes=r-n+1,t}var ta=Or,ea=128,Do=127;function Or(e,n){var r=0,n=n||0,o=0,s=n,i,a=e.length;do{if(s>=a)throw Or.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&Do)<<o:(i&Do)*Math.pow(2,o),o+=7}while(i>=ea);return Or.bytes=s-n,r}var ra=Math.pow(2,7),na=Math.pow(2,14),oa=Math.pow(2,21),sa=Math.pow(2,28),ia=Math.pow(2,35),aa=Math.pow(2,42),ca=Math.pow(2,49),ua=Math.pow(2,56),fa=Math.pow(2,63),la=function(e){return e<ra?1:e<na?2:e<oa?3:e<sa?4:e<ia?5:e<aa?6:e<ca?7:e<ua?8:e<fa?9:10},ha={encode:Xi,decode:ta,encodingLength:la},da=ha,Te=da;function Ke(e,t=0){return[Te.decode(e,t),Te.decode.bytes]}function ue(e,t,r=0){return Te.encode(e,t,r),t}function fe(e){return Te.encodingLength(e)}function Et(e,t){let r=t.byteLength,n=fe(e),o=n+fe(r),s=new Uint8Array(o+r);return ue(e,s,0),ue(r,s,n),s.set(t,o),new le(e,r,t,s)}function Mr(e){let t=It(e),[r,n]=Ke(t),[o,s]=Ke(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new le(r,o,i,t)}function To(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&So(e.bytes,r.bytes)}}var le=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function Ko(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return ma(r,qr(e),t??X.encoder);default:return ya(r,qr(e),t??ce.encoder)}}var Co=new WeakMap;function qr(e){let t=Co.get(e);if(t==null){let r=new Map;return Co.set(e,r),r}return t}var st=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Ce)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==ba)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=Et(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&To(t.multihash,n.multihash)}toString(t){return Ko(this,t)}toJSON(){return{"/":Ko(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??Uo(n,o,s.bytes))}else if(r[xa]===!0){let{version:n,multihash:o,code:s}=r,i=Mr(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Ce)throw new Error(`Version 0 CID must use dag-pb (code: ${Ce}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=Uo(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,Ce,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=It(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new le(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[f,x]=Ke(t.subarray(r));return r+=x,f},o=n(),s=Ce;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,a=n(),c=n(),u=r+c,l=u-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(t,r){let[n,o]=pa(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return qr(s).set(n,t),s}};function pa(e,t){switch(e[0]){case"Q":{let r=t??X;return[X.prefix,r.decode(`${X.prefix}${e}`)]}case X.prefix:{let r=t??X;return[X.prefix,r.decode(e)]}case ce.prefix:{let r=t??ce;return[ce.prefix,r.decode(e)]}case Re.prefix:{let r=t??Re;return[Re.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function ma(e,t,r){let{prefix:n}=r;if(n!==X.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function ya(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var Ce=112,ba=18;function Uo(e,t,r){let n=fe(e),o=n+fe(t),s=new Uint8Array(o+r.byteLength);return ue(e,s,0),ue(t,s,n),s.set(r,o),s}var xa=Symbol.for("@ipld/js-cid/CID");var Hr={};ft(Hr,{identity:()=>St});var No=0,ga="identity",Po=It;function wa(e,t){if(t?.truncate!=null&&t.truncate!==e.byteLength){if(t.truncate<0||t.truncate>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,t.truncate)}return Et(No,Po(e))}var St={code:No,name:ga,encode:Po,digest:wa};function it(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function bt(e=0){return new Uint8Array(e)}function lt(e=0){return new Uint8Array(e)}function tr(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=lt(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var Oo=Symbol.for("@achingbrain/uint8arraylist");function ko(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function er(e){return!!e?.[Oo]}var Q=class e{bufs;length;[Oo]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(er(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(er(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=ko(this.bufs,t);return r.buf[r.index]}set(t,r){let n=ko(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(er(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return tr(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:tr(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,t>=c)continue;let u=t>=a&&t<c,l=r>a&&r<=c;if(u&&l){if(t===a&&r===c){n.push(i);break}let f=t-a;n.push(i.subarray(f,f+(r-t)));break}if(u){if(t===0){n.push(i);continue}n.push(i.subarray(t-a));continue}if(l){if(r===c){n.push(i);break}n.push(i.subarray(0,r-a));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!er(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let f=0;f<s;f++)i[f]=-1;for(let f=0;f<o;f++)i[n[f]]=f;let a=i,c=this.byteLength-n.byteLength,u=n.byteLength-1,l;for(let f=r;f<=c;f+=l){l=0;for(let x=u;x>=0;x--){let y=this.get(f+x);if(n[x]!==y){l=Math.max(1,x-a[y]);break}}if(l===0)return f}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=lt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=bt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=bt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=bt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=lt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=bt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=bt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=bt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=bt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=bt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!it(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var Vr={};ft(Vr,{base10:()=>Ea});var Ea=Nt({prefix:"9",name:"base10",alphabet:"0123456789"});var Fr={};ft(Fr,{base16:()=>Sa,base16upper:()=>va});var Sa=Y({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),va=Y({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Zr={};ft(Zr,{base2:()=>Aa});var Aa=Y({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var zr={};ft(zr,{base256emoji:()=>Da});var Mo=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Ba=Mo.reduce((e,t,r)=>(e[r]=t,e),[]),Ia=Mo.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function La(e){return e.reduce((t,r)=>(t+=Ba[r],t),"")}function _a(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=Ia[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var Da=ae({prefix:"\u{1F680}",name:"base256emoji",encode:La,decode:_a});var jr={};ft(jr,{base64:()=>Ra,base64pad:()=>Ta,base64url:()=>Ka,base64urlpad:()=>Ca});var Ra=Y({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ta=Y({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ka=Y({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ca=Y({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Gr={};ft(Gr,{base8:()=>Ua});var Ua=Y({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Yr={};ft(Yr,{identity:()=>Na});var Na=ae({prefix:"\0",name:"identity",encode:e=>Ao(e),decode:e=>vo(e)});var Tf=new TextEncoder,Kf=new TextDecoder;var Wr={};ft(Wr,{sha256:()=>rr,sha512:()=>Ma});var Oa=20;function Xr({name:e,code:t,encode:r,minDigestLength:n,maxDigestLength:o}){return new $r(e,t,r,n,o)}var $r=class{name;code;encode;minDigestLength;maxDigestLength;constructor(t,r,n,o,s){this.name=t,this.code=r,this.encode=n,this.minDigestLength=o??Oa,this.maxDigestLength=s}digest(t,r){if(r?.truncate!=null){if(r.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&r.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(t instanceof Uint8Array){let n=this.encode(t);return n instanceof Uint8Array?qo(n,this.code,r?.truncate):n.then(o=>qo(o,this.code,r?.truncate))}else throw Error("Unknown type, must be binary type")}};function qo(e,t,r){if(r!=null&&r!==e.byteLength){if(r>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,r)}return Et(t,e)}function Vo(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var rr=Xr({name:"sha2-256",code:18,encode:Vo("SHA-256")}),Ma=Xr({name:"sha2-512",code:19,encode:Vo("SHA-512")});var Jr={...Yr,...Zr,...Gr,...Vr,...Fr,...Pr,...kr,...Nr,...jr,...zr},Zf={...Wr,...Hr};function Zo(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var Fo=Zo("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),Qr=Zo("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=lt(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),qa={utf8:Fo,"utf-8":Fo,hex:Jr.base16,latin1:Qr,ascii:Qr,binary:Qr,...Jr},nr=qa;function W(e,t="utf8"){let r=nr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function $(e,t="utf8"){let r=nr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var Ha=parseInt("11111",2),tn=parseInt("10000000",2),Va=parseInt("01111111",2),zo={0:Ue,1:Ue,2:Fa,3:ja,4:Ga,5:za,6:Za,16:Ue,22:Ue,48:Ue};function vt(e,t={offset:0}){let r=e[t.offset]&Ha;if(t.offset++,zo[r]!=null)return zo[r](e,t);throw new Error("No decoder for tag "+r)}function Ne(e,t){let r=0;if((e[t.offset]&tn)===tn){let n=e[t.offset]&Va,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function Ue(e,t){Ne(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=vt(e,t);if(n===null)break;r.push(n)}return r}function Fa(e,t){let r=Ne(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function Za(e,t){let r=Ne(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let a=`${s}.${i}`,c=[];for(;t.offset<n;){let u=e[t.offset];if(t.offset++,c.push(u&127),u<128){c.reverse();let l=0;for(let f=0;f<c.length;f++)l+=c[f]<<f*7;a+=`.${l}`,c=[]}}return a}function za(e,t){return t.offset++,null}function ja(e,t){let r=Ne(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function Ga(e,t){let r=Ne(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function Ya(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new Q;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function en(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=Ya(e.byteLength);return new Q(Uint8Array.from([t.byteLength|tn]),t)}function ht(e){let t=new Q,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new Q(Uint8Array.from([2]),en(t),t)}function or(e){let t=Uint8Array.from([0]),r=new Q(t,e);return new Q(Uint8Array.from([3]),en(r),r)}function Pt(e,t=48){let r=new Q;for(let n of e)r.append(n);return new Q(Uint8Array.from([t]),en(r),r)}var jo="1.2.840.10045.3.1.7",Go="1.3.132.0.34",Yo="1.3.132.0.35";async function $o(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var $a=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Xa=Uint8Array.from([6,5,43,129,4,0,34]),Wa=Uint8Array.from([6,5,43,129,4,0,35]),Ja={ext:!0,kty:"EC",crv:"P-256"},Qa={ext:!0,kty:"EC",crv:"P-384"},tc={ext:!0,kty:"EC",crv:"P-521"},rn=32,nn=48,on=66;function Xo(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===rn*2+1)return n=$(t.subarray(r,r+rn),"base64url"),o=$(t.subarray(r+rn),"base64url"),new de({...Ja,key_ops:["verify"],x:n,y:o});if(t.byteLength===nn*2+1)return n=$(t.subarray(r,r+nn),"base64url"),o=$(t.subarray(r+nn),"base64url"),new de({...Qa,key_ops:["verify"],x:n,y:o});if(t.byteLength===on*2+1)return n=$(t.subarray(r,r+on),"base64url"),o=$(t.subarray(r+on),"base64url"),new de({...tc,key_ops:["verify"],x:n,y:o});throw new G(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function Wo(e){return Pt([ht(Uint8Array.from([1])),Pt([ec(e.crv)],160),Pt([or(new Q(Uint8Array.from([4]),W(e.x??"","base64url"),W(e.y??"","base64url")))],161)]).subarray()}function ec(e){if(e==="P-256")return $a;if(e==="P-384")return Xa;if(e==="P-521")return Wa;throw new G(`Invalid curve ${e}`)}var de=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=Wo(this.jwk)),this._raw}toMultihash(){return St.digest(pe(this))}toCID(){return st.createV1(114,this.toMultihash())}toString(){return X.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}async verify(t,r,n){return $o(this.jwk,r,t,n)}};function jt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function At(e,t=""){if(!Number.isSafeInteger(e)||e<0){let r=t&&`"${t}" `;throw new Error(`${r}expected integer >= 0, got ${e}`)}}function P(e,t,r=""){let n=jt(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){let i=r&&`"${r}" `,a=s?` of length ${t}`:"",c=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return e}function sr(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");At(e.outputLen),At(e.blockLen)}function me(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Qo(e,t){P(e,void 0,"digestInto() output");let r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function _t(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ir(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function xt(e,t){return e<<32-t|e>>>t}var ts=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",rc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Dt(e){if(P(e),ts)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=rc[e[r]];return t}var Lt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Jo(e){if(e>=Lt._0&&e<=Lt._9)return e-Lt._0;if(e>=Lt.A&&e<=Lt.F)return e-(Lt.A-10);if(e>=Lt.a&&e<=Lt.f)return e-(Lt.a-10)}function Rt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(ts)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=Jo(e.charCodeAt(s)),a=Jo(e.charCodeAt(s+1));if(i===void 0||a===void 0){let c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function dt(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];P(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}function sn(e,t={}){let r=(o,s)=>e(s).update(o).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=o=>e(o),Object.assign(r,t),Object.freeze(r)}function ye(e=32){let t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}var an=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function es(e,t,r){return e&t^~e&r}function rs(e,t,r){return e&t^e&r^t&r}var Pe=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,r,n,o){this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=ir(this.buffer)}update(t){me(this),P(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=ir(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){me(this),Qo(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,_t(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let f=i;f<o;f++)r[f]=0;n.setBigUint64(o-8,BigInt(this.length*8),s),this.process(n,0);let a=ir(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||=new this.constructor,t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=a,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Tt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var nt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var ar=BigInt(4294967295),ns=BigInt(32);function nc(e,t=!1){return t?{h:Number(e&ar),l:Number(e>>ns&ar)}:{h:Number(e>>ns&ar)|0,l:Number(e&ar)|0}}function os(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:a}=nc(e[s],t);[n[s],o[s]]=[i,a]}return[n,o]}var cn=(e,t,r)=>e>>>r,un=(e,t,r)=>e<<32-r|t>>>r,Gt=(e,t,r)=>e>>>r|t<<32-r,Yt=(e,t,r)=>e<<32-r|t>>>r,ke=(e,t,r)=>e<<64-r|t>>>r-32,Oe=(e,t,r)=>e>>>r-32|t<<64-r;function Bt(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var ss=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),is=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,as=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),cs=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,us=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),fs=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var sc=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),kt=new Uint32Array(64),fn=class extends Pe{constructor(t){super(64,t,8,!1)}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let f=0;f<16;f++,r+=4)kt[f]=t.getUint32(r,!1);for(let f=16;f<64;f++){let x=kt[f-15],y=kt[f-2],d=xt(x,7)^xt(x,18)^x>>>3,B=xt(y,17)^xt(y,19)^y>>>10;kt[f]=B+kt[f-7]+d+kt[f-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){let x=xt(a,6)^xt(a,11)^xt(a,25),y=l+x+es(a,c,u)+sc[f]+kt[f]|0,B=(xt(n,2)^xt(n,13)^xt(n,22))+rs(n,o,s)|0;l=u,u=c,c=a,a=i+y|0,i=s,s=o,o=n,n=y+B|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,s,i,a,c,u,l)}roundClean(){_t(kt)}destroy(){this.set(0,0,0,0,0,0,0,0),_t(this.buffer)}},ln=class extends fn{A=Tt[0]|0;B=Tt[1]|0;C=Tt[2]|0;D=Tt[3]|0;E=Tt[4]|0;F=Tt[5]|0;G=Tt[6]|0;H=Tt[7]|0;constructor(){super(32)}};var ls=os(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),ic=ls[0],ac=ls[1],Ot=new Uint32Array(80),Mt=new Uint32Array(80),hn=class extends Pe{constructor(t){super(128,t,16,!1)}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:u,El:l,Fh:f,Fl:x,Gh:y,Gl:d,Hh:B,Hl:v}=this;return[t,r,n,o,s,i,a,c,u,l,f,x,y,d,B,v]}set(t,r,n,o,s,i,a,c,u,l,f,x,y,d,B,v){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=f|0,this.Fl=x|0,this.Gh=y|0,this.Gl=d|0,this.Hh=B|0,this.Hl=v|0}process(t,r){for(let g=0;g<16;g++,r+=4)Ot[g]=t.getUint32(r),Mt[g]=t.getUint32(r+=4);for(let g=16;g<80;g++){let I=Ot[g-15]|0,C=Mt[g-15]|0,k=Gt(I,C,1)^Gt(I,C,8)^cn(I,C,7),O=Yt(I,C,1)^Yt(I,C,8)^un(I,C,7),E=Ot[g-2]|0,w=Mt[g-2]|0,U=Gt(E,w,19)^ke(E,w,61)^cn(E,w,6),M=Yt(E,w,19)^Oe(E,w,61)^un(E,w,6),R=as(O,M,Mt[g-7],Mt[g-16]),p=cs(R,k,U,Ot[g-7],Ot[g-16]);Ot[g]=p|0,Mt[g]=R|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:u,Dl:l,Eh:f,El:x,Fh:y,Fl:d,Gh:B,Gl:v,Hh:b,Hl:A}=this;for(let g=0;g<80;g++){let I=Gt(f,x,14)^Gt(f,x,18)^ke(f,x,41),C=Yt(f,x,14)^Yt(f,x,18)^Oe(f,x,41),k=f&y^~f&B,O=x&d^~x&v,E=us(A,C,O,ac[g],Mt[g]),w=fs(E,b,I,k,ic[g],Ot[g]),U=E|0,M=Gt(n,o,28)^ke(n,o,34)^ke(n,o,39),R=Yt(n,o,28)^Oe(n,o,34)^Oe(n,o,39),p=n&s^n&a^s&a,m=o&i^o&c^i&c;b=B|0,A=v|0,B=y|0,v=d|0,y=f|0,d=x|0,{h:f,l:x}=Bt(u|0,l|0,w|0,U|0),u=a|0,l=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let h=ss(U,R,m);n=is(h,w,M,p),o=h|0}({h:n,l:o}=Bt(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=Bt(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=Bt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Bt(this.Dh|0,this.Dl|0,u|0,l|0),{h:f,l:x}=Bt(this.Eh|0,this.El|0,f|0,x|0),{h:y,l:d}=Bt(this.Fh|0,this.Fl|0,y|0,d|0),{h:B,l:v}=Bt(this.Gh|0,this.Gl|0,B|0,v|0),{h:b,l:A}=Bt(this.Hh|0,this.Hl|0,b|0,A|0),this.set(n,o,s,i,a,c,u,l,f,x,y,d,B,v,b,A)}roundClean(){_t(Ot,Mt)}destroy(){_t(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},dn=class extends hn{Ah=nt[0]|0;Al=nt[1]|0;Bh=nt[2]|0;Bl=nt[3]|0;Ch=nt[4]|0;Cl=nt[5]|0;Dh=nt[6]|0;Dl=nt[7]|0;Eh=nt[8]|0;El=nt[9]|0;Fh=nt[10]|0;Fl=nt[11]|0;Gh=nt[12]|0;Gl=nt[13]|0;Hh=nt[14]|0;Hl=nt[15]|0;constructor(){super(64)}};var be=sn(()=>new ln,an(1));var hs=sn(()=>new dn,an(3));var mn=BigInt(0),pn=BigInt(1);function Kt(e,t=""){if(typeof e!="boolean"){let r=t&&`"${t}" `;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function ds(e){if(typeof e=="bigint"){if(!cr(e))throw new Error("positive bigint expected, got "+e)}else At(e);return e}function Me(e){let t=ds(e).toString(16);return t.length&1?"0"+t:t}function ps(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?mn:BigInt("0x"+e)}function xe(e){return ps(Dt(e))}function $t(e){return ps(Dt(fr(P(e)).reverse()))}function ur(e,t){At(t),e=ds(e);let r=Rt(e.toString(16).padStart(t*2,"0"));if(r.length!==t)throw new Error("number too large");return r}function yn(e,t){return ur(e,t).reverse()}function fr(e){return Uint8Array.from(e)}var cr=e=>typeof e=="bigint"&&mn<=e;function cc(e,t,r){return cr(e)&&cr(t)&&cr(r)&&t<=e&&e<r}function qe(e,t,r,n){if(!cc(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function bn(e){let t;for(t=0;e>mn;e>>=pn,t+=1);return t}var He=e=>(pn<<BigInt(e))-pn;function ms(e,t,r){if(At(e,"hashLen"),At(t,"qByteLen"),typeof r!="function")throw new Error("hmacFn must be a function");let n=v=>new Uint8Array(v),o=Uint8Array.of(),s=Uint8Array.of(0),i=Uint8Array.of(1),a=1e3,c=n(e),u=n(e),l=0,f=()=>{c.fill(1),u.fill(0),l=0},x=(...v)=>r(u,dt(c,...v)),y=(v=o)=>{u=x(s,v),c=x(),v.length!==0&&(u=x(i,v),c=x())},d=()=>{if(l++>=a)throw new Error("drbg: tried max amount of iterations");let v=0,b=[];for(;v<t;){c=x();let A=c.slice();b.push(A),v+=c.length}return dt(...b)};return(v,b)=>{f(),y(v);let A;for(;!(A=b(d()));)y();return f(),A}}function qt(e,t={},r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,i,a){let c=e[s];if(a&&c===void 0)return;let u=typeof c;if(u!==i||c===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${u}`)}let o=(s,i)=>Object.entries(s).forEach(([a,c])=>n(a,c,i));o(t,!1),o(r,!0)}function ge(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var ut=BigInt(0),tt=BigInt(1),Xt=BigInt(2),xs=BigInt(3),gs=BigInt(4),ws=BigInt(5),uc=BigInt(7),Es=BigInt(8),fc=BigInt(9),Ss=BigInt(16);function J(e,t){let r=e%t;return r>=ut?r:t+r}function F(e,t,r){let n=e;for(;t-- >ut;)n*=n,n%=r;return n}function ys(e,t){if(e===ut)throw new Error("invert: expected non-zero number");if(t<=ut)throw new Error("invert: expected positive modulus, got "+t);let r=J(e,t),n=t,o=ut,s=tt,i=tt,a=ut;for(;r!==ut;){let u=n/r,l=n%r,f=o-i*u,x=s-a*u;n=r,r=l,o=i,s=a,i=f,a=x}if(n!==tt)throw new Error("invert: does not exist");return J(o,t)}function gn(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function vs(e,t){let r=(e.ORDER+tt)/gs,n=e.pow(t,r);return gn(e,n,t),n}function lc(e,t){let r=(e.ORDER-ws)/Es,n=e.mul(t,Xt),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,Xt),o),a=e.mul(s,e.sub(i,e.ONE));return gn(e,a,t),a}function hc(e){let t=we(e),r=As(e),n=r(t,t.neg(t.ONE)),o=r(t,n),s=r(t,t.neg(n)),i=(e+uc)/Ss;return(a,c)=>{let u=a.pow(c,i),l=a.mul(u,n),f=a.mul(u,o),x=a.mul(u,s),y=a.eql(a.sqr(l),c),d=a.eql(a.sqr(f),c);u=a.cmov(u,l,y),l=a.cmov(x,f,d);let B=a.eql(a.sqr(l),c),v=a.cmov(u,l,B);return gn(a,v,c),v}}function As(e){if(e<xs)throw new Error("sqrt is not defined for small field");let t=e-tt,r=0;for(;t%Xt===ut;)t/=Xt,r++;let n=Xt,o=we(e);for(;bs(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return vs;let s=o.pow(n,t),i=(t+tt)/Xt;return function(c,u){if(c.is0(u))return u;if(bs(c,u)!==1)throw new Error("Cannot find square root");let l=r,f=c.mul(c.ONE,s),x=c.pow(u,t),y=c.pow(u,i);for(;!c.eql(x,c.ONE);){if(c.is0(x))return c.ZERO;let d=1,B=c.sqr(x);for(;!c.eql(B,c.ONE);)if(d++,B=c.sqr(B),d===l)throw new Error("Cannot find square root");let v=tt<<BigInt(l-d-1),b=c.pow(f,v);l=d,f=c.sqr(b),x=c.mul(x,f),y=c.mul(y,b)}return y}}function dc(e){return e%gs===xs?vs:e%Es===ws?lc:e%Ss===fc?hc(e):As(e)}var Bs=(e,t)=>(J(e,t)&tt)===tt,pc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function wn(e){let t={ORDER:"bigint",BYTES:"number",BITS:"number"},r=pc.reduce((n,o)=>(n[o]="function",n),t);return qt(e,r),e}function mc(e,t,r){if(r<ut)throw new Error("invalid exponent, negatives unsupported");if(r===ut)return e.ONE;if(r===tt)return t;let n=e.ONE,o=t;for(;r>ut;)r&tt&&(n=e.mul(n,o)),o=e.sqr(o),r>>=tt;return n}function Ve(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,a,c)=>e.is0(a)?i:(n[c]=i,e.mul(i,a)),e.ONE),s=e.inv(o);return t.reduceRight((i,a,c)=>e.is0(a)?i:(n[c]=e.mul(i,n[c]),e.mul(i,a)),s),n}function bs(e,t){let r=(e.ORDER-tt)/Xt,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function yc(e,t){t!==void 0&&At(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}var xn=class{ORDER;BITS;BYTES;isLE;ZERO=ut;ONE=tt;_lengths;_sqrt;_mod;constructor(t,r={}){if(t<=ut)throw new Error("invalid field: expected ORDER > 0, got "+t);let n;this.isLE=!1,r!=null&&typeof r=="object"&&(typeof r.BITS=="number"&&(n=r.BITS),typeof r.sqrt=="function"&&(this.sqrt=r.sqrt),typeof r.isLE=="boolean"&&(this.isLE=r.isLE),r.allowedLengths&&(this._lengths=r.allowedLengths?.slice()),typeof r.modFromBytes=="boolean"&&(this._mod=r.modFromBytes));let{nBitLength:o,nByteLength:s}=yc(t,n);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return J(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return ut<=t&&t<this.ORDER}is0(t){return t===ut}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&tt)===tt}neg(t){return J(-t,this.ORDER)}eql(t,r){return t===r}sqr(t){return J(t*t,this.ORDER)}add(t,r){return J(t+r,this.ORDER)}sub(t,r){return J(t-r,this.ORDER)}mul(t,r){return J(t*r,this.ORDER)}pow(t,r){return mc(this,t,r)}div(t,r){return J(t*ys(r,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,r){return t+r}subN(t,r){return t-r}mulN(t,r){return t*r}inv(t){return ys(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=dc(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?yn(t,this.BYTES):ur(t,this.BYTES)}fromBytes(t,r=!1){P(t);let{_lengths:n,BYTES:o,isLE:s,ORDER:i,_mod:a}=this;if(n){if(!n.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+t.length);let u=new Uint8Array(o);u.set(t,s?0:u.length-t.length),t=u}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let c=s?$t(t):xe(t);if(a&&(c=J(c,i)),!r&&!this.isValid(c))throw new Error("invalid field element: outside of range 0..ORDER");return c}invertBatch(t){return Ve(this,t)}cmov(t,r,n){return n?r:t}};function we(e,t={}){return new xn(e,t)}function Is(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function En(e){let t=Is(e);return t+Math.ceil(t/2)}function Sn(e,t,r=!1){P(e);let n=e.length,o=Is(t),s=En(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?$t(e):xe(e),a=J(i,t-tt)+tt;return r?yn(a,o):ur(a,o)}var Ee=BigInt(0),Wt=BigInt(1);function Fe(e,t){let r=t.negate();return e?r:t}function Jt(e,t){let r=Ve(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function Rs(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function vn(e,t){Rs(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=He(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function Ls(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,a=Number(e&o),c=e>>i;a>n&&(a-=s,c+=Wt);let u=t*n,l=u+Math.abs(a)-1,f=a===0,x=a<0,y=t%2!==0;return{nextN:c,offset:l,isZero:f,isNeg:x,isNegF:y,offsetF:u}}var An=new WeakMap,Ts=new WeakMap;function Bn(e){return Ts.get(e)||1}function _s(e){if(e!==Ee)throw new Error("invalid wNAF")}var Se=class{BASE;ZERO;Fn;bits;constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>Ee;)r&Wt&&(n=n.add(o)),o=o.double(),r>>=Wt;return n}precomputeWindow(t,r){let{windows:n,windowSize:o}=vn(r,this.bits),s=[],i=t,a=i;for(let c=0;c<n;c++){a=i,s.push(a);for(let u=1;u<o;u++)a=a.add(i),s.push(a);i=a.double()}return s}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=vn(t,this.bits);for(let a=0;a<i.windows;a++){let{nextN:c,offset:u,isZero:l,isNeg:f,isNegF:x,offsetF:y}=Ls(n,a,i);n=c,l?s=s.add(Fe(x,r[y])):o=o.add(Fe(f,r[u]))}return _s(n),{p:o,f:s}}wNAFUnsafe(t,r,n,o=this.ZERO){let s=vn(t,this.bits);for(let i=0;i<s.windows&&n!==Ee;i++){let{nextN:a,offset:c,isZero:u,isNeg:l}=Ls(n,i,s);if(n=a,!u){let f=r[c];o=o.add(l?f.negate():f)}}return _s(n),o}getPrecomputes(t,r,n){let o=An.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),An.set(r,o))),o}cached(t,r,n){let o=Bn(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){let s=Bn(t);return s===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,n),r,o)}createCache(t,r){Rs(r,this.bits),Ts.set(t,r),An.delete(t)}hasCache(t){return Bn(t)!==1}};function Ks(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>Ee||n>Ee;)r&Wt&&(s=s.add(o)),n&Wt&&(i=i.add(o)),o=o.double(),r>>=Wt,n>>=Wt;return{p1:s,p2:i}}function Ds(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return wn(t),t}else return we(e,{isLE:r})}function lr(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let c of["p","n","h"]){let u=t[c];if(!(typeof u=="bigint"&&u>Ee))throw new Error(`CURVE.${c} must be positive bigint`)}let o=Ds(t.p,r.Fp,n),s=Ds(t.n,r.Fn,n),a=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let c of a)if(!o.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}function hr(e,t){return function(n){let o=e(n);return{secretKey:o,publicKey:t(o)}}}var Ht=BigInt(0),et=BigInt(1),In=BigInt(2),bc=BigInt(8);function xc(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),a=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,a)}function Cs(e,t={}){let r=lr("edwards",e,t,t.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;qt(t,{},{uvRatio:"function"});let a=In<<BigInt(o.BYTES*8)-et,c=v=>n.create(v),u=t.uvRatio||((v,b)=>{try{return{isValid:!0,value:n.sqrt(n.div(v,b))}}catch{return{isValid:!1,value:Ht}}});if(!xc(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function l(v,b,A=!1){let g=A?et:Ht;return qe("coordinate "+v,b,g,a),b}function f(v){if(!(v instanceof d))throw new Error("EdwardsPoint expected")}let x=ge((v,b)=>{let{X:A,Y:g,Z:I}=v,C=v.is0();b==null&&(b=C?bc:n.inv(I));let k=c(A*b),O=c(g*b),E=n.mul(I,b);if(C)return{x:Ht,y:et};if(E!==et)throw new Error("invZ was invalid");return{x:k,y:O}}),y=ge(v=>{let{a:b,d:A}=s;if(v.is0())throw new Error("bad point: ZERO");let{X:g,Y:I,Z:C,T:k}=v,O=c(g*g),E=c(I*I),w=c(C*C),U=c(w*w),M=c(O*b),R=c(w*c(M+E)),p=c(U+c(A*c(O*E)));if(R!==p)throw new Error("bad point: equation left != right (1)");let m=c(g*I),h=c(C*k);if(m!==h)throw new Error("bad point: equation left != right (2)");return!0});class d{static BASE=new d(s.Gx,s.Gy,et,c(s.Gx*s.Gy));static ZERO=new d(Ht,et,et,Ht);static Fp=n;static Fn=o;X;Y;Z;T;constructor(b,A,g,I){this.X=l("x",b),this.Y=l("y",A),this.Z=l("z",g,!0),this.T=l("t",I),Object.freeze(this)}static CURVE(){return s}static fromAffine(b){if(b instanceof d)throw new Error("extended point not allowed");let{x:A,y:g}=b||{};return l("x",A),l("y",g),new d(A,g,et,c(A*g))}static fromBytes(b,A=!1){let g=n.BYTES,{a:I,d:C}=s;b=fr(P(b,g,"point")),Kt(A,"zip215");let k=fr(b),O=b[g-1];k[g-1]=O&-129;let E=$t(k),w=A?a:n.ORDER;qe("point.y",E,Ht,w);let U=c(E*E),M=c(U-et),R=c(C*U-I),{isValid:p,value:m}=u(M,R);if(!p)throw new Error("bad point: invalid y coordinate");let h=(m&et)===et,S=(O&128)!==0;if(!A&&m===Ht&&S)throw new Error("bad point: x=0 and x_0=1");return S!==h&&(m=c(-m)),d.fromAffine({x:m,y:E})}static fromHex(b,A=!1){return d.fromBytes(Rt(b),A)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(b=8,A=!0){return B.createCache(this,b),A||this.multiply(In),this}assertValidity(){y(this)}equals(b){f(b);let{X:A,Y:g,Z:I}=this,{X:C,Y:k,Z:O}=b,E=c(A*O),w=c(C*I),U=c(g*O),M=c(k*I);return E===w&&U===M}is0(){return this.equals(d.ZERO)}negate(){return new d(c(-this.X),this.Y,this.Z,c(-this.T))}double(){let{a:b}=s,{X:A,Y:g,Z:I}=this,C=c(A*A),k=c(g*g),O=c(In*c(I*I)),E=c(b*C),w=A+g,U=c(c(w*w)-C-k),M=E+k,R=M-O,p=E-k,m=c(U*R),h=c(M*p),S=c(U*p),L=c(R*M);return new d(m,h,L,S)}add(b){f(b);let{a:A,d:g}=s,{X:I,Y:C,Z:k,T:O}=this,{X:E,Y:w,Z:U,T:M}=b,R=c(I*E),p=c(C*w),m=c(O*g*M),h=c(k*U),S=c((I+C)*(E+w)-R-p),L=h-m,D=h+m,T=c(p-A*R),_=c(S*L),K=c(D*T),N=c(S*T),Z=c(L*D);return new d(_,K,Z,N)}subtract(b){return this.add(b.negate())}multiply(b){if(!o.isValidNot0(b))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:A,f:g}=B.cached(this,b,I=>Jt(d,I));return Jt(d,[A,g])[0]}multiplyUnsafe(b,A=d.ZERO){if(!o.isValid(b))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return b===Ht?d.ZERO:this.is0()||b===et?this:B.unsafe(this,b,g=>Jt(d,g),A)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return B.unsafe(this,s.n).is0()}toAffine(b){return x(this,b)}clearCofactor(){return i===et?this:this.multiplyUnsafe(i)}toBytes(){let{x:b,y:A}=this.toAffine(),g=n.toBytes(A);return g[g.length-1]|=b&et?128:0,g}toHex(){return Dt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let B=new Se(d,o.BITS);return d.BASE.precompute(8),d}function Us(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');qt(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=e,a=r.randomBytes||ye,c=r.adjustScalarBytes||(E=>E),u=r.domain||((E,w,U)=>{if(Kt(U,"phflag"),w.length||U)throw new Error("Contexts/pre-hash are not supported");return E});function l(E){return i.create($t(E))}function f(E){let w=g.secretKey;P(E,g.secretKey,"secretKey");let U=P(t(E),2*w,"hashedSecretKey"),M=c(U.slice(0,w)),R=U.slice(w,2*w),p=l(M);return{head:M,prefix:R,scalar:p}}function x(E){let{head:w,prefix:U,scalar:M}=f(E),R=o.multiply(M),p=R.toBytes();return{head:w,prefix:U,scalar:M,point:R,pointBytes:p}}function y(E){return x(E).pointBytes}function d(E=Uint8Array.of(),...w){let U=dt(...w);return l(t(u(U,P(E,void 0,"context"),!!n)))}function B(E,w,U={}){E=P(E,void 0,"message"),n&&(E=n(E));let{prefix:M,scalar:R,pointBytes:p}=x(w),m=d(U.context,M,E),h=o.multiply(m).toBytes(),S=d(U.context,h,p,E),L=i.create(m+S*R);if(!i.isValid(L))throw new Error("sign failed: invalid s");let D=dt(h,i.toBytes(L));return P(D,g.signature,"result")}let v={zip215:!0};function b(E,w,U,M=v){let{context:R,zip215:p}=M,m=g.signature;E=P(E,m,"signature"),w=P(w,void 0,"message"),U=P(U,g.publicKey,"publicKey"),p!==void 0&&Kt(p,"zip215"),n&&(w=n(w));let h=m/2,S=E.subarray(0,h),L=$t(E.subarray(h,m)),D,T,_;try{D=e.fromBytes(U,p),T=e.fromBytes(S,p),_=o.multiplyUnsafe(L)}catch{return!1}if(!p&&D.isSmallOrder())return!1;let K=d(R,T.toBytes(),D.toBytes(),w);return T.add(D.multiplyUnsafe(K)).subtract(_).clearCofactor().is0()}let A=s.BYTES,g={secretKey:A,publicKey:A,signature:2*A,seed:A};function I(E=a(g.seed)){return P(E,g.seed,"seed")}function C(E){return jt(E)&&E.length===i.BYTES}function k(E,w){try{return!!e.fromBytes(E,w)}catch{return!1}}let O={getExtendedPublicKey:x,randomSecretKey:I,isValidSecretKey:C,isValidPublicKey:k,toMontgomery(E){let{y:w}=e.fromBytes(E),U=g.publicKey,M=U===32;if(!M&&U!==57)throw new Error("only defined for 25519 and 448");let R=M?s.div(et+w,et-w):s.div(w-et,w+et);return s.toBytes(R)},toMontgomerySecret(E){let w=g.secretKey;P(E,w);let U=t(E.subarray(0,w));return c(U).subarray(0,w)}};return Object.freeze({keygen:hr(I,y),getPublicKey:y,sign:B,verify:b,utils:O,Point:e,lengths:g})}var gc=BigInt(1),Ns=BigInt(2);var wc=BigInt(5),Ec=BigInt(8),Ln=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Sc={p:Ln,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Ec,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function vc(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=Ln,a=e*e%s*e%s,c=F(a,Ns,s)*a%s,u=F(c,gc,s)*e%s,l=F(u,wc,s)*u%s,f=F(l,t,s)*l%s,x=F(f,r,s)*f%s,y=F(x,n,s)*x%s,d=F(y,o,s)*y%s,B=F(d,o,s)*y%s,v=F(B,t,s)*l%s;return{pow_p_5_8:F(v,Ns,s)*e%s,b2:a}}function Ac(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Ps=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Bc(e,t){let r=Ln,n=J(t*t*t,r),o=J(n*n*t,r),s=vc(e*o).pow_p_5_8,i=J(e*n*s,r),a=J(t*i*i,r),c=i,u=J(i*Ps,r),l=a===e,f=a===J(-e,r),x=a===J(-e*Ps,r);return l&&(i=c),(f||x)&&(i=u),Bs(i,r)&&(i=J(-i,r)),{isValid:l||f,value:i}}var Ic=Cs(Sc,{uvRatio:Bc});function Lc(e){return Us(Ic,hs,Object.assign({adjustScalarBytes:Ac},e))}var ks=Lc({});var Ze=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},dr=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Os={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new dr("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var yt=Os;var ve=32;var _n,_c=(async()=>{try{return await yt.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function Dc(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await yt.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await yt.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function Rc(e,t,r){return ks.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function Ms(e,t,r){return _n==null&&(_n=await _c),_n?Dc(e,t,r):Rc(e,t,r)}function pr(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var mr=class{type="Ed25519";raw;constructor(t){this.raw=Dn(t,ve)}toMultihash(){return St.digest(pe(this))}toCID(){return st.createV1(114,this.toMultihash())}toString(){return X.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=Ms(this.raw,r,t);return pr(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}};function Vs(e){return e=Dn(e,ve),new mr(e)}function Dn(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new G(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var Tc=Math.pow(2,7),Kc=Math.pow(2,14),Cc=Math.pow(2,21),Rn=Math.pow(2,28),Tn=Math.pow(2,35),Kn=Math.pow(2,42),Cn=Math.pow(2,49),H=128,at=127;function Ct(e){if(e<Tc)return 1;if(e<Kc)return 2;if(e<Cc)return 3;if(e<Rn)return 4;if(e<Tn)return 5;if(e<Kn)return 6;if(e<Cn)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Un(e,t,r=0){switch(Ct(e)){case 8:t[r++]=e&255|H,e/=128;case 7:t[r++]=e&255|H,e/=128;case 6:t[r++]=e&255|H,e/=128;case 5:t[r++]=e&255|H,e/=128;case 4:t[r++]=e&255|H,e>>>=7;case 3:t[r++]=e&255|H,e>>>=7;case 2:t[r++]=e&255|H,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function Uc(e,t,r=0){switch(Ct(e)){case 8:t.set(r++,e&255|H),e/=128;case 7:t.set(r++,e&255|H),e/=128;case 6:t.set(r++,e&255|H),e/=128;case 5:t.set(r++,e&255|H),e/=128;case 4:t.set(r++,e&255|H),e>>>=7;case 3:t.set(r++,e&255|H),e>>>=7;case 2:t.set(r++,e&255|H),e>>>=7;case 1:{t.set(r++,e&255),e>>>=7;break}default:throw new Error("unreachable")}return t}function Nn(e,t){let r=e[t],n=0;if(n+=r&at,r<H||(r=e[t+1],n+=(r&at)<<7,r<H)||(r=e[t+2],n+=(r&at)<<14,r<H)||(r=e[t+3],n+=(r&at)<<21,r<H)||(r=e[t+4],n+=(r&at)*Rn,r<H)||(r=e[t+5],n+=(r&at)*Tn,r<H)||(r=e[t+6],n+=(r&at)*Kn,r<H)||(r=e[t+7],n+=(r&at)*Cn,r<H))return n;throw new RangeError("Could not decode varint")}function Nc(e,t){let r=e.get(t),n=0;if(n+=r&at,r<H||(r=e.get(t+1),n+=(r&at)<<7,r<H)||(r=e.get(t+2),n+=(r&at)<<14,r<H)||(r=e.get(t+3),n+=(r&at)<<21,r<H)||(r=e.get(t+4),n+=(r&at)*Rn,r<H)||(r=e.get(t+5),n+=(r&at)*Tn,r<H)||(r=e.get(t+6),n+=(r&at)*Kn,r<H)||(r=e.get(t+7),n+=(r&at)*Cn,r<H))return n;throw new RangeError("Could not decode varint")}function Fs(e,t,r=0){return t==null&&(t=lt(Ct(e))),t instanceof Uint8Array?Un(e,t,r):Uc(e,t,r)}function Zs(e,t=0){return e instanceof Uint8Array?Nn(e,t):Nc(e,t)}var Pn=new Float32Array([-0]),Vt=new Uint8Array(Pn.buffer);function zs(e,t,r){Pn[0]=e,t[r]=Vt[0],t[r+1]=Vt[1],t[r+2]=Vt[2],t[r+3]=Vt[3]}function js(e,t){return Vt[0]=e[t],Vt[1]=e[t+1],Vt[2]=e[t+2],Vt[3]=e[t+3],Pn[0]}var kn=new Float64Array([-0]),ct=new Uint8Array(kn.buffer);function Gs(e,t,r){kn[0]=e,t[r]=ct[0],t[r+1]=ct[1],t[r+2]=ct[2],t[r+3]=ct[3],t[r+4]=ct[4],t[r+5]=ct[5],t[r+6]=ct[6],t[r+7]=ct[7]}function Ys(e,t){return ct[0]=e[t],ct[1]=e[t+1],ct[2]=e[t+2],ct[3]=e[t+3],ct[4]=e[t+4],ct[5]=e[t+5],ct[6]=e[t+6],ct[7]=e[t+7],kn[0]}var kc=BigInt(Number.MAX_SAFE_INTEGER),Oc=BigInt(Number.MIN_SAFE_INTEGER),mt=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return Qt;if(t<kc&&t>Oc)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>$s&&(o=0n,++n>$s&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return Qt;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):Qt}},Qt=new mt(0,0);Qt.toBigInt=function(){return 0n};Qt.zzEncode=Qt.zzDecode=function(){return this};Qt.length=function(){return 1};var $s=4294967296n;function Xs(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function Ws(e,t,r){if(r-t<1)return"";let o,s=[],i=0,a;for(;t<r;)a=e[t++],a<128?s[i++]=a:a>191&&a<224?s[i++]=(a&31)<<6|e[t++]&63:a>239&&a<365?(a=((a&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(a>>10),s[i++]=56320+(a&1023)):s[i++]=(a&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function On(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function gt(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function yr(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var Mn=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,gt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw gt(this,4);return yr(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw gt(this,4);return yr(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw gt(this,4);let t=js(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw gt(this,4);let t=Ys(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw gt(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return Ws(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw gt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw gt(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new mt(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw gt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw gt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw gt(this,8);let t=yr(this.buf,this.pos+=4),r=yr(this.buf,this.pos+=4);return new mt(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=Nn(this.buf,this.pos);return this.pos+=Ct(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function qn(e){return new Mn(e instanceof Uint8Array?e:e.subarray())}function te(e,t,r){let n=qn(e);return t.decode(n,void 0,r)}function Hn(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return lt(i);o+i>t&&(n=lt(t),o=0);let a=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),a}}var ee=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function Vn(){}var Zn=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},Mc=Hn();function qc(e){return globalThis.Buffer!=null?lt(e):Mc(e)}var je=class{len;head;tail;states;constructor(){this.len=0,this.head=new ee(Vn,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new ee(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new zn((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(br,10,mt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=mt.fromBigInt(t);return this._push(br,r.length(),r)}uint64Number(t){return this._push(Un,Ct(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=mt.fromBigInt(t).zzEncode();return this._push(br,r.length(),r)}sint64Number(t){let r=mt.fromNumber(t).zzEncode();return this._push(br,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(Fn,1,t?1:0)}fixed32(t){return this._push(ze,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=mt.fromBigInt(t);return this._push(ze,4,r.lo)._push(ze,4,r.hi)}fixed64Number(t){let r=mt.fromNumber(t);return this._push(ze,4,r.lo)._push(ze,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(zs,4,t)}double(t){return this._push(Gs,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(Fn,1,0):this.uint32(r)._push(Vc,r,t)}string(t){let r=Xs(t);return r!==0?this.uint32(r)._push(On,r,t):this._push(Fn,1,0)}fork(){return this.states=new Zn(this),this.head=this.tail=new ee(Vn,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ee(Vn,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=qc(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function Fn(e,t,r){t[r]=e&255}function Hc(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var zn=class extends ee{next;constructor(t,r){super(Hc,t,r),this.next=void 0}};function br(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function ze(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function Vc(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(je.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(Fc,t,e),this},je.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(Zc,t,e),this});function Fc(e,t,r){t.set(e,r)}function Zc(e,t,r){e.length<40?On(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(W(e),r)}function jn(){return new je}function re(e,t){let r=jn();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Ae;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(Ae||(Ae={}));function xr(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function Ge(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let a=t(s);i.int32(a)},n=function(s){let i=s.int32();return t(i)};return xr("enum",Ae.VARINT,r,n)}function ne(e,t){return xr("message",Ae.LENGTH_DELIMITED,e,t)}var pt;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(pt||(pt={}));var Gn;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(Gn||(Gn={}));(function(e){e.codec=()=>Ge(Gn)})(pt||(pt={}));var Ft;(function(e){let t;e.codec=()=>(t==null&&(t=ne((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),pt.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=pt.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>re(r,e.codec()),e.decode=(r,n)=>te(r,e.codec(),n)})(Ft||(Ft={}));var Yn;(function(e){let t;e.codec=()=>(t==null&&(t=ne((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),pt.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=pt.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>re(r,e.codec()),e.decode=(r,n)=>te(r,e.codec(),n)})(Yn||(Yn={}));var $e={};ft($e,{MAX_RSA_KEY_SIZE:()=>$n,generateRSAKeyPair:()=>oi,jwkToJWKKeyPair:()=>si,jwkToPkcs1:()=>Yc,jwkToPkix:()=>Qn,jwkToRSAPrivateKey:()=>eo,pkcs1MessageToJwk:()=>Wn,pkcs1MessageToRSAPrivateKey:()=>to,pkcs1ToJwk:()=>Gc,pkcs1ToRSAPrivateKey:()=>ri,pkixMessageToJwk:()=>Jn,pkixMessageToRSAPublicKey:()=>gr,pkixToJwk:()=>$c,pkixToRSAPublicKey:()=>ni});var Be=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=$e.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return st.createV1(114,this._multihash)}toString(){return X.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}verify(t,r,n){return ei(this.jwk,r,t,n)}},Ye=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=$e.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}sign(t,r){return ti(this.jwk,t,r)}};var $n=8192,Xn=18,zc=1062,jc=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Gc(e){let t=vt(e);return Wn(t)}function Wn(e){return{n:$(e[1],"base64url"),e:$(e[2],"base64url"),d:$(e[3],"base64url"),p:$(e[4],"base64url"),q:$(e[5],"base64url"),dp:$(e[6],"base64url"),dq:$(e[7],"base64url"),qi:$(e[8],"base64url"),kty:"RSA"}}function Yc(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new G("JWK was missing components");return Pt([ht(Uint8Array.from([0])),ht(W(e.n,"base64url")),ht(W(e.e,"base64url")),ht(W(e.d,"base64url")),ht(W(e.p,"base64url")),ht(W(e.q,"base64url")),ht(W(e.dp,"base64url")),ht(W(e.dq,"base64url")),ht(W(e.qi,"base64url"))]).subarray()}function $c(e){let t=vt(e,{offset:0});return Jn(t)}function Jn(e){let t=vt(e[1],{offset:0});return{kty:"RSA",n:$(t[0],"base64url"),e:$(t[1],"base64url")}}function Qn(e){if(e.n==null||e.e==null)throw new G("JWK was missing components");return Pt([jc,or(Pt([ht(W(e.n,"base64url")),ht(W(e.e,"base64url"))]))]).subarray()}function ri(e){let t=vt(e);return to(t)}function to(e){let t=Wn(e);return eo(t)}function ni(e,t){if(e.byteLength>=zc)throw new se("Key size is too large");let r=vt(e,{offset:0});return gr(r,e,t)}function gr(e,t,r){let n=Jn(e);if(r==null){let o=be(Ft.encode({Type:pt.RSA,Data:t}));r=Et(Xn,o)}return new Be(n,r)}function eo(e){if(ai(e)>$n)throw new G("Key size is too large");let t=si(e),r=be(Ft.encode({Type:pt.RSA,Data:Qn(t.publicKey)})),n=Et(Xn,r);return new Ye(t.privateKey,new Be(t.publicKey,n))}async function oi(e){if(e>$n)throw new G("Key size is too large");let t=await ii(e),r=be(Ft.encode({Type:pt.RSA,Data:Qn(t.publicKey)})),n=Et(Xn,r);return new Ye(t.privateKey,new Be(t.publicKey,n))}function si(e){if(e==null)throw new G("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}var ci="1.2.840.113549.1.1.1";async function ii(e,t){let r=await yt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await Xc(r,t);return{privateKey:n[0],publicKey:n[1]}}async function ti(e,t,r){let n=await yt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await yt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function ei(e,t,r,n){let o=await yt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await yt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function Xc(e,t){if(e.privateKey==null||e.publicKey==null)throw new G("Private and public key are required");let r=await Promise.all([yt.get().subtle.exportKey("jwk",e.privateKey),yt.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function ai(e){if(e.kty!=="RSA")throw new G("invalid key type");if(e.n==null)throw new G("invalid key modulus");return W(e.n,"base64url").length*8}var wr=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(sr(t),P(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),_t(o)}update(t){return me(this),this.iHash.update(t),this}digestInto(t){me(this),P(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ro=(e,t,r)=>new wr(e,t).update(r).digest();ro.create=(e,t)=>new wr(e,t);var ui=(e,t)=>(e+(e>=0?t:-t)/fi)/t;function Wc(e,t,r){let[[n,o],[s,i]]=t,a=ui(i*e,r),c=ui(-o*e,r),u=e-a*n-c*s,l=-a*o-c*i,f=u<Ut,x=l<Ut;f&&(u=-u),x&&(l=-l);let y=He(Math.ceil(bn(r)/2))+Ie;if(u<Ut||u>=y||l<Ut||l>=y)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:f,k1:u,k2neg:x,k2:l}}function oo(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function no(e,t){let r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return Kt(r.lowS,"lowS"),Kt(r.prehash,"prehash"),r.format!==void 0&&oo(r.format),r}var so=class extends Error{constructor(t=""){super(t)}},Zt={Err:so,_tlv:{encode:(e,t)=>{let{Err:r}=Zt;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=Me(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?Me(o.length/2|128):"";return Me(e)+s+o+t},decode(e,t){let{Err:r}=Zt,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let u=t.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let l of u)i=i<<8|l;if(n+=c,i<128)throw new r("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+i);if(a.length!==i)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=Zt;if(e<Ut)throw new t("integer: negative integers are not allowed");let r=Me(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=Zt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return xe(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=Zt,o=P(e,void 0,"signature"),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(e){let{_tlv:t,_int:r}=Zt,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},Ut=BigInt(0),Ie=BigInt(1),fi=BigInt(2),Er=BigInt(3),Jc=BigInt(4);function li(e,t={}){let r=lr("weierstrass",e,t),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:a}=s;qt(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});let{endo:c}=t;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=di(n,o);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function f(R,p,m){let{x:h,y:S}=p.toAffine(),L=n.toBytes(h);if(Kt(m,"isCompressed"),m){l();let D=!n.isOdd(S);return dt(hi(D),L)}else return dt(Uint8Array.of(4),L,n.toBytes(S))}function x(R){P(R,void 0,"Point");let{publicKey:p,publicKeyUncompressed:m}=u,h=R.length,S=R[0],L=R.subarray(1);if(h===p&&(S===2||S===3)){let D=n.fromBytes(L);if(!n.isValid(D))throw new Error("bad point: is not on curve, wrong x");let T=B(D),_;try{_=n.sqrt(T)}catch(Z){let V=Z instanceof Error?": "+Z.message:"";throw new Error("bad point: is not on curve, sqrt error"+V)}l();let K=n.isOdd(_);return(S&1)===1!==K&&(_=n.neg(_)),{x:D,y:_}}else if(h===m&&S===4){let D=n.BYTES,T=n.fromBytes(L.subarray(0,D)),_=n.fromBytes(L.subarray(D,D*2));if(!v(T,_))throw new Error("bad point: is not on curve");return{x:T,y:_}}else throw new Error(`bad point: got length ${h}, expected compressed=${p} or uncompressed=${m}`)}let y=t.toBytes||f,d=t.fromBytes||x;function B(R){let p=n.sqr(R),m=n.mul(p,R);return n.add(n.add(m,n.mul(R,s.a)),s.b)}function v(R,p){let m=n.sqr(p),h=B(R);return n.eql(m,h)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let b=n.mul(n.pow(s.a,Er),Jc),A=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(b,A)))throw new Error("bad curve params: a or b");function g(R,p,m=!1){if(!n.isValid(p)||m&&n.is0(p))throw new Error(`bad point coordinate ${R}`);return p}function I(R){if(!(R instanceof w))throw new Error("Weierstrass Point expected")}function C(R){if(!c||!c.basises)throw new Error("no endo");return Wc(R,c.basises,o.ORDER)}let k=ge((R,p)=>{let{X:m,Y:h,Z:S}=R;if(n.eql(S,n.ONE))return{x:m,y:h};let L=R.is0();p==null&&(p=L?n.ONE:n.inv(S));let D=n.mul(m,p),T=n.mul(h,p),_=n.mul(S,p);if(L)return{x:n.ZERO,y:n.ZERO};if(!n.eql(_,n.ONE))throw new Error("invZ was invalid");return{x:D,y:T}}),O=ge(R=>{if(R.is0()){if(t.allowInfinityPoint&&!n.is0(R.Y))return;throw new Error("bad point: ZERO")}let{x:p,y:m}=R.toAffine();if(!n.isValid(p)||!n.isValid(m))throw new Error("bad point: x or y not field elements");if(!v(p,m))throw new Error("bad point: equation left != right");if(!R.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function E(R,p,m,h,S){return m=new w(n.mul(m.X,R),m.Y,m.Z),p=Fe(h,p),m=Fe(S,m),p.add(m)}class w{static BASE=new w(s.Gx,s.Gy,n.ONE);static ZERO=new w(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=o;X;Y;Z;constructor(p,m,h){this.X=g("x",p),this.Y=g("y",m,!0),this.Z=g("z",h),Object.freeze(this)}static CURVE(){return s}static fromAffine(p){let{x:m,y:h}=p||{};if(!p||!n.isValid(m)||!n.isValid(h))throw new Error("invalid affine point");if(p instanceof w)throw new Error("projective point not allowed");return n.is0(m)&&n.is0(h)?w.ZERO:new w(m,h,n.ONE)}static fromBytes(p){let m=w.fromAffine(d(P(p,void 0,"point")));return m.assertValidity(),m}static fromHex(p){return w.fromBytes(Rt(p))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(p=8,m=!0){return M.createCache(this,p),m||this.multiply(Er),this}assertValidity(){O(this)}hasEvenY(){let{y:p}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(p)}equals(p){I(p);let{X:m,Y:h,Z:S}=this,{X:L,Y:D,Z:T}=p,_=n.eql(n.mul(m,T),n.mul(L,S)),K=n.eql(n.mul(h,T),n.mul(D,S));return _&&K}negate(){return new w(this.X,n.neg(this.Y),this.Z)}double(){let{a:p,b:m}=s,h=n.mul(m,Er),{X:S,Y:L,Z:D}=this,T=n.ZERO,_=n.ZERO,K=n.ZERO,N=n.mul(S,S),Z=n.mul(L,L),V=n.mul(D,D),q=n.mul(S,L);return q=n.add(q,q),K=n.mul(S,D),K=n.add(K,K),T=n.mul(p,K),_=n.mul(h,V),_=n.add(T,_),T=n.sub(Z,_),_=n.add(Z,_),_=n.mul(T,_),T=n.mul(q,T),K=n.mul(h,K),V=n.mul(p,V),q=n.sub(N,V),q=n.mul(p,q),q=n.add(q,K),K=n.add(N,N),N=n.add(K,N),N=n.add(N,V),N=n.mul(N,q),_=n.add(_,N),V=n.mul(L,D),V=n.add(V,V),N=n.mul(V,q),T=n.sub(T,N),K=n.mul(V,Z),K=n.add(K,K),K=n.add(K,K),new w(T,_,K)}add(p){I(p);let{X:m,Y:h,Z:S}=this,{X:L,Y:D,Z:T}=p,_=n.ZERO,K=n.ZERO,N=n.ZERO,Z=s.a,V=n.mul(s.b,Er),q=n.mul(m,L),z=n.mul(h,D),rt=n.mul(S,T),wt=n.add(m,h),j=n.add(L,D);wt=n.mul(wt,j),j=n.add(q,z),wt=n.sub(wt,j),j=n.add(m,S);let ot=n.add(L,T);return j=n.mul(j,ot),ot=n.add(q,rt),j=n.sub(j,ot),ot=n.add(h,S),_=n.add(D,T),ot=n.mul(ot,_),_=n.add(z,rt),ot=n.sub(ot,_),N=n.mul(Z,j),_=n.mul(V,rt),N=n.add(_,N),_=n.sub(z,N),N=n.add(z,N),K=n.mul(_,N),z=n.add(q,q),z=n.add(z,q),rt=n.mul(Z,rt),j=n.mul(V,j),z=n.add(z,rt),rt=n.sub(q,rt),rt=n.mul(Z,rt),j=n.add(j,rt),q=n.mul(z,j),K=n.add(K,q),q=n.mul(ot,j),_=n.mul(wt,_),_=n.sub(_,q),q=n.mul(wt,z),N=n.mul(ot,N),N=n.add(N,q),new w(_,K,N)}subtract(p){return this.add(p.negate())}is0(){return this.equals(w.ZERO)}multiply(p){let{endo:m}=t;if(!o.isValidNot0(p))throw new Error("invalid scalar: out of range");let h,S,L=D=>M.cached(this,D,T=>Jt(w,T));if(m){let{k1neg:D,k1:T,k2neg:_,k2:K}=C(p),{p:N,f:Z}=L(T),{p:V,f:q}=L(K);S=Z.add(q),h=E(m.beta,N,V,D,_)}else{let{p:D,f:T}=L(p);h=D,S=T}return Jt(w,[h,S])[0]}multiplyUnsafe(p){let{endo:m}=t,h=this;if(!o.isValid(p))throw new Error("invalid scalar: out of range");if(p===Ut||h.is0())return w.ZERO;if(p===Ie)return h;if(M.hasCache(this))return this.multiply(p);if(m){let{k1neg:S,k1:L,k2neg:D,k2:T}=C(p),{p1:_,p2:K}=Ks(w,h,L,T);return E(m.beta,_,K,S,D)}else return M.unsafe(h,p)}toAffine(p){return k(this,p)}isTorsionFree(){let{isTorsionFree:p}=t;return i===Ie?!0:p?p(w,this):M.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:p}=t;return i===Ie?this:p?p(w,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(p=!0){return Kt(p,"isCompressed"),this.assertValidity(),y(w,this,p)}toHex(p=!0){return Dt(this.toBytes(p))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let U=o.BITS,M=new Se(w,t.endo?Math.ceil(U/2):U);return w.BASE.precompute(8),w}function hi(e){return Uint8Array.of(e?2:3)}function di(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function Qc(e,t={}){let{Fn:r}=e,n=t.randomBytes||ye,o=Object.assign(di(e.Fp,r),{seed:En(r.ORDER)});function s(y){try{let d=r.fromBytes(y);return r.isValidNot0(d)}catch{return!1}}function i(y,d){let{publicKey:B,publicKeyUncompressed:v}=o;try{let b=y.length;return d===!0&&b!==B||d===!1&&b!==v?!1:!!e.fromBytes(y)}catch{return!1}}function a(y=n(o.seed)){return Sn(P(y,o.seed,"seed"),r.ORDER)}function c(y,d=!0){return e.BASE.multiply(r.fromBytes(y)).toBytes(d)}function u(y){let{secretKey:d,publicKey:B,publicKeyUncompressed:v}=o;if(!jt(y)||"_lengths"in r&&r._lengths||d===B)return;let b=P(y,void 0,"key").length;return b===B||b===v}function l(y,d,B=!0){if(u(y)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");let v=r.fromBytes(y);return e.fromBytes(d).multiply(v).toBytes(B)}let f={isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:a},x=hr(a,c);return Object.freeze({getPublicKey:c,getSharedSecret:l,keygen:x,Point:e,utils:f,lengths:o})}function pi(e,t,r={}){sr(t),qt(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),r=Object.assign({},r);let n=r.randomBytes||ye,o=r.hmac||((m,h)=>ro(t,m,h)),{Fp:s,Fn:i}=e,{ORDER:a,BITS:c}=i,{keygen:u,getPublicKey:l,getSharedSecret:f,utils:x,lengths:y}=Qc(e,r),d={prehash:!0,lowS:typeof r.lowS=="boolean"?r.lowS:!0,format:"compact",extraEntropy:!1},B=a*fi<s.ORDER;function v(m){let h=a>>Ie;return m>h}function b(m,h){if(!i.isValidNot0(h))throw new Error(`invalid signature ${m}: out of range 1..Point.Fn.ORDER`);return h}function A(){if(B)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function g(m,h){oo(h);let S=y.signature,L=h==="compact"?S:h==="recovered"?S+1:void 0;return P(m,L)}class I{r;s;recovery;constructor(h,S,L){if(this.r=b("r",h),this.s=b("s",S),L!=null){if(A(),![0,1,2,3].includes(L))throw new Error("invalid recovery id");this.recovery=L}Object.freeze(this)}static fromBytes(h,S=d.format){g(h,S);let L;if(S==="der"){let{r:K,s:N}=Zt.toSig(P(h));return new I(K,N)}S==="recovered"&&(L=h[0],S="compact",h=h.subarray(1));let D=y.signature/2,T=h.subarray(0,D),_=h.subarray(D,D*2);return new I(i.fromBytes(T),i.fromBytes(_),L)}static fromHex(h,S){return this.fromBytes(Rt(h),S)}assertRecovery(){let{recovery:h}=this;if(h==null)throw new Error("invalid recovery id: must be present");return h}addRecoveryBit(h){return new I(this.r,this.s,h)}recoverPublicKey(h){let{r:S,s:L}=this,D=this.assertRecovery(),T=D===2||D===3?S+a:S;if(!s.isValid(T))throw new Error("invalid recovery id: sig.r+curve.n != R.x");let _=s.toBytes(T),K=e.fromBytes(dt(hi((D&1)===0),_)),N=i.inv(T),Z=k(P(h,void 0,"msgHash")),V=i.create(-Z*N),q=i.create(L*N),z=e.BASE.multiplyUnsafe(V).add(K.multiplyUnsafe(q));if(z.is0())throw new Error("invalid recovery: point at infinify");return z.assertValidity(),z}hasHighS(){return v(this.s)}toBytes(h=d.format){if(oo(h),h==="der")return Rt(Zt.hexFromSig(this));let{r:S,s:L}=this,D=i.toBytes(S),T=i.toBytes(L);return h==="recovered"?(A(),dt(Uint8Array.of(this.assertRecovery()),D,T)):dt(D,T)}toHex(h){return Dt(this.toBytes(h))}}let C=r.bits2int||function(h){if(h.length>8192)throw new Error("input is too large");let S=xe(h),L=h.length*8-c;return L>0?S>>BigInt(L):S},k=r.bits2int_modN||function(h){return i.create(C(h))},O=He(c);function E(m){return qe("num < 2^"+c,m,Ut,O),i.toBytes(m)}function w(m,h){return P(m,void 0,"message"),h?P(t(m),void 0,"prehashed message"):m}function U(m,h,S){let{lowS:L,prehash:D,extraEntropy:T}=no(S,d);m=w(m,D);let _=k(m),K=i.fromBytes(h);if(!i.isValidNot0(K))throw new Error("invalid private key");let N=[E(K),E(_)];if(T!=null&&T!==!1){let z=T===!0?n(y.secretKey):T;N.push(P(z,void 0,"extraEntropy"))}let Z=dt(...N),V=_;function q(z){let rt=C(z);if(!i.isValidNot0(rt))return;let wt=i.inv(rt),j=e.BASE.multiply(rt).toAffine(),ot=i.create(j.x);if(ot===Ut)return;let We=i.create(wt*i.create(V+ot*K));if(We===Ut)return;let go=(j.x===ot?0:2)|Number(j.y&Ie),wo=We;return L&&v(We)&&(wo=i.neg(We),go^=1),new I(ot,wo,B?void 0:go)}return{seed:Z,k2sig:q}}function M(m,h,S={}){let{seed:L,k2sig:D}=U(m,h,S);return ms(t.outputLen,i.BYTES,o)(L,D).toBytes(S.format)}function R(m,h,S,L={}){let{lowS:D,prehash:T,format:_}=no(L,d);if(S=P(S,void 0,"publicKey"),h=w(h,T),!jt(m)){let K=m instanceof I?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+K)}g(m,_);try{let K=I.fromBytes(m,_),N=e.fromBytes(S);if(D&&K.hasHighS())return!1;let{r:Z,s:V}=K,q=k(h),z=i.inv(V),rt=i.create(q*z),wt=i.create(Z*z),j=e.BASE.multiplyUnsafe(rt).add(N.multiplyUnsafe(wt));return j.is0()?!1:i.create(j.x)===Z}catch{return!1}}function p(m,h,S={}){let{prehash:L}=no(S,d);return h=w(h,L),I.fromBytes(m,"recovered").recoverPublicKey(h).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:f,utils:x,lengths:y,Point:e,sign:M,verify:R,recoverPublicKey:p,Signature:I,hash:t})}var ao={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},tu={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]};var mi=BigInt(2);function eu(e){let t=ao.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,l=u*u*e%t,f=F(l,r,t)*l%t,x=F(f,r,t)*l%t,y=F(x,mi,t)*u%t,d=F(y,o,t)*y%t,B=F(d,s,t)*d%t,v=F(B,a,t)*B%t,b=F(v,c,t)*v%t,A=F(b,a,t)*B%t,g=F(A,r,t)*l%t,I=F(g,i,t)*d%t,C=F(I,n,t)*u%t,k=F(C,mi,t);if(!io.eql(io.sqr(k),e))throw new Error("Cannot find square root");return k}var io=we(ao.p,{sqrt:eu}),ru=li(ao,{Fp:io,endo:tu}),Le=pi(ru,be);var yi=33;function bi(e,t,r,n){let o=rr.digest(r instanceof Uint8Array?r:r.subarray());if(pr(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),Le.verify(t,s,e,{prehash:!1,format:"der"}))).catch(s=>{throw s.name==="AbortError"?s:new Ze(String(s))});try{return n?.signal?.throwIfAborted(),Le.verify(t,o.digest,e,{prehash:!1,format:"der"})}catch(s){throw new Ze(String(s))}}var Sr=class{type="secp256k1";raw;_key;constructor(t){this._key=gi(t),this.raw=xi(this._key)}toMultihash(){return St.digest(pe(this))}toCID(){return st.createV1(114,this.toMultihash())}toString(){return X.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}verify(t,r,n){return bi(this._key,r,t,n)}};function wi(e){return new Sr(e)}function xi(e){return Le.Point.fromBytes(e).toBytes()}function gi(e){try{return Le.Point.fromBytes(e),e}catch(t){throw new se(String(t))}}function Ei(e){if(e.byteLength===ve)return Vs(e);if(e.byteLength===yi)return wi(e);let t=vt(e),r=t[1]?.[0];if(r===jo||r===Go||r===Yo)return Xo(t);if(t[0]?.[0]===ci)return gr(t,e);throw new G("Could not extract public key from raw bytes")}function pe(e){return Ft.encode({Type:pt[e.type],Data:e.raw})}var Si=Symbol.for("nodejs.util.inspect.custom"),nu=114,Xe=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Rr]=!0;toString(){return this.string==null&&(this.string=X.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return st.createV1(nu,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return it(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return it(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[Si](){return`PeerId(${this.toString()})`}},vr=class extends Xe{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Ar=class extends Xe{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},Br=class extends Xe{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},ou=2336,co=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=St.digest(W(this.url))}[Si](){return`PeerId(${this.url})`}[Rr]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return st.createV1(ou,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=$(t)),t.toString()===this.toString())}};function vi(e){if(e.type==="Ed25519")return new Ar({multihash:e.toCID().multihash,publicKey:e});if(e.type==="secp256k1")return new Br({multihash:e.toCID().multihash,publicKey:e});if(e.type==="RSA")return new vr({multihash:e.toCID().multihash,publicKey:e});throw new De}var uo=class extends Error{constructor(t){super(t),this.name="TimeoutError"}},fo=class extends Error{constructor(t){super(),this.name="AbortError",this.message=t}},Ai=e=>globalThis.DOMException===void 0?new fo(e):new DOMException(e),Bi=e=>{let t=e.reason===void 0?Ai("This operation was aborted."):e.reason;return t instanceof Error?t:Ai(t)};function lo(e,t){let{milliseconds:r,fallback:n,message:o,customTimers:s={setTimeout,clearTimeout}}=t,i,a,u=new Promise((l,f)=>{if(typeof r!="number"||Math.sign(r)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(t.signal){let{signal:y}=t;y.aborted&&f(Bi(y)),a=()=>{f(Bi(y))},y.addEventListener("abort",a,{once:!0})}if(r===Number.POSITIVE_INFINITY){e.then(l,f);return}let x=new uo;i=s.setTimeout.call(void 0,()=>{if(n){try{l(n())}catch(y){f(y)}return}typeof e.cancel=="function"&&e.cancel(),o===!1?l():o instanceof Error?f(o):(x.message=o??`Promise timed out after ${r} milliseconds`,f(x))},r),(async()=>{try{l(await e)}catch(y){f(y)}})()}).finally(()=>{u.clear(),a&&t.signal&&t.signal.removeEventListener("abort",a)});return u.clear=()=>{s.clearTimeout.call(void 0,i),i=void 0},u}var su=e=>{let t=e.addEventListener||e.on||e.addListener,r=e.removeEventListener||e.off||e.removeListener;if(!t||!r)throw new TypeError("Emitter is not compatible");return{addListener:t.bind(e),removeListener:r.bind(e)}};function iu(e,t,r){let n,o=new Promise((s,i)=>{if(r={rejectionEvents:["error"],multiArgs:!1,rejectionMultiArgs:!1,resolveImmediately:!1,...r},!(r.count>=0&&(r.count===Number.POSITIVE_INFINITY||Number.isInteger(r.count))))throw new TypeError("The `count` option should be at least 0 or more");r.signal?.throwIfAborted();let a=[t].flat(),c=[],{addListener:u,removeListener:l}=su(e),f=async(...y)=>{let d=r.multiArgs?y:y[0];if(r.filter)try{if(!await r.filter(d))return}catch(B){n(),i(B);return}c.push(d),r.count===c.length&&(n(),s(c))},x=(...y)=>{n(),i(r.rejectionMultiArgs?y:y[0])};n=()=>{for(let y of a)l(y,f);for(let y of r.rejectionEvents)a.includes(y)||l(y,x)};for(let y of a)u(y,f);for(let y of r.rejectionEvents)a.includes(y)||u(y,x);r.signal&&r.signal.addEventListener("abort",()=>{x(r.signal.reason)},{once:!0}),r.resolveImmediately&&s(c)});if(o.cancel=n,typeof r.timeout=="number"){let s=lo(o,{milliseconds:r.timeout});return s.cancel=()=>{n(),s.clear()},s}return o}function Ii(e,t,r){typeof r=="function"&&(r={filter:r}),r={...r,count:1,resolveImmediately:!1};let n=iu(e,t,r),o=n.then(s=>s[0]);return o.cancel=n.cancel,o}var oe=class extends Error{static name="UnexpectedEOFError";name="UnexpectedEOFError"};function au(e){return e.reason}async function Li(e,t,r){if(t==null)return e;let n=r?.translateError??au;if(t.aborted)return e.catch(()=>{}),Promise.reject(n(t));let o;try{return await Promise.race([e,new Promise((s,i)=>{o=()=>{i(n(t))},t.addEventListener("abort",o)})])}finally{o!=null&&t.removeEventListener("abort",o)}}var uu=4194304,Ir=class extends Error{static name="UnwrappedError";name="UnwrappedError"},po=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},mo=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},yo=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function fu(e){return typeof e?.closeRead=="function"}function lu(e){return typeof e?.close=="function"}function ho(e){return fu(e)?e.remoteWriteStatus!=="writable"&&e.readBufferLength===0:lu(e)?e.status!=="open":!1}function hu(e){return e?.addEventListener!=null&&e?.removeEventListener!=null&&e?.send!=null&&e?.push!=null&&e?.log!=null}function du(e,t){let r=t?.maxBufferSize??uu,n=new Q,o,s=!1;if(!hu(e))throw new G("Argument should be a Stream or a Multiaddr");let i=l=>{if(n.append(l.data),n.byteLength>r){let f=n.byteLength;n.consume(n.byteLength),o?.reject(new Error(`Read buffer overflow - ${f} > ${r}`))}o?.resolve()};e.addEventListener("message",i);let a=l=>{l.error!=null?o?.reject(l.error):o?.resolve()};e.addEventListener("close",a);let c=()=>{o?.resolve()};e.addEventListener("remoteCloseWrite",c);let u={readBuffer:n,async read(l){if(s===!0)throw new Ir("Stream was unwrapped");if(ho(e)){if(l?.bytes==null)return null;if(n.byteLength<l.bytes)throw e.log.error("closed after reading %d/%d bytes",n.byteLength,l.bytes),new oe(`Unexpected EOF - stream closed after reading ${n.byteLength}/${l.bytes} bytes`)}let f=l?.bytes??1;for(o=Promise.withResolvers();;){if(n.byteLength>=f){o.resolve();break}if(await Li(o.promise,l?.signal),ho(e)){if(n.byteLength===0&&l?.bytes==null)return null;break}o=Promise.withResolvers()}let x=l?.bytes??n.byteLength;if(n.byteLength<x){if(ho(e))throw e.log.error("closed while reading %d/%d bytes",n.byteLength,x),new oe(`Unexpected EOF - stream closed while reading ${n.byteLength}/${x} bytes`);return u.read(l)}let y=n.sublist(0,x);return n.consume(x),y},async write(l,f){if(s===!0)throw new Ir("Stream was unwrapped");e.send(l)||await Ii(e,"drain",{signal:f?.signal,rejectionEvents:["close"]})},unwrap(){return s||(s=!0,e.removeEventListener("message",i),e.removeEventListener("close",a),e.removeEventListener("remoteCloseWrite",c),n.byteLength>0&&(e.log("stream unwrapped with %d unread bytes",n.byteLength),e.push(n))),e}};return u}function pu(e,t={}){let r=du(e,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=Ct(t.maxDataLength));let n=t?.lengthDecoder??Zs,o=t?.lengthEncoder??Fs;return{async read(i){let a=-1,c=new Q;for(;;){let l=await r.read({...i,bytes:1});if(l==null)break;c.append(l);try{a=n(c)}catch(f){if(f instanceof RangeError)continue;throw f}if(a<0)throw new po("Invalid message length");if(t?.maxLengthLength!=null&&c.byteLength>t.maxLengthLength)throw new yo(`Message length length too long - ${c.byteLength} > ${t.maxLengthLength}`);if(a>-1)break}if(t?.maxDataLength!=null&&a>t.maxDataLength)throw new mo(`Message length too long - ${a} > ${t.maxDataLength}`);let u=await r.read({...i,bytes:a});if(u==null)throw e.log.error("tried to read %d bytes but the stream closed",a),new oe(`Unexpected EOF - tried to read ${a} bytes but the stream closed`);if(u.byteLength!==a)throw e.log.error("read %d/%d bytes before the stream closed",u.byteLength,a),new oe(`Unexpected EOF - read ${u.byteLength}/${a} bytes before the stream closed`);return u},async write(i,a){await r.write(new Q(o(i.byteLength),i),a)},async writeV(i,a){let c=new Q(...i.flatMap(u=>[o(u.byteLength),u]));await r.write(c,a)},unwrap(){return r.unwrap()}}}function _i(e,t){let r=pu(e,t),n={read:async(o,s)=>{let i=await r.read(s);return o.decode(i)},write:async(o,s,i)=>{await r.write(s.encode(o),i)},writeV:async(o,s,i)=>{await r.writeV(o.map(a=>s.encode(a)),i)},pb:o=>({read:async s=>n.read(o,s),write:async(s,i)=>n.write(s,o,i),writeV:async(s,i)=>n.writeV(s,o,i),unwrap:()=>n}),unwrap:()=>r.unwrap()};return n}var Lr;(function(e){let t;e.codec=()=>(t==null&&(t=ne((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.id!=null&&(n.uint32(10),n.bytes(r.id)),r.pubkey!=null&&(n.uint32(18),_r.codec().encode(r.pubkey,n)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.id=r.bytes();break}case 2:{s.pubkey=_r.codec().decode(r,r.uint32(),{limits:o.limits?.pubkey});break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>re(r,e.codec()),e.decode=(r,n)=>te(r,e.codec(),n)})(Lr||(Lr={}));var zt;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(zt||(zt={}));var bo;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(bo||(bo={}));(function(e){e.codec=()=>Ge(bo)})(zt||(zt={}));var _r;(function(e){let t;e.codec=()=>(t==null&&(t=ne((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),zt.codec().encode(r.Type,n)),r.Data!=null&&r.Data.byteLength>0&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={Data:bt(0)},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=zt.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>re(r,e.codec()),e.decode=(r,n)=>te(r,e.codec(),n)})(_r||(_r={}));var mu="/plaintext/2.0.0",xo=class{protocol=mu;privateKey;log;constructor(t){this.privateKey=t.privateKey,this.log=t.logger.forComponent("libp2p:plaintext")}[Symbol.toStringTag]="@libp2p/plaintext";[Eo]=["@libp2p/connection-encryption"];async secureInbound(t,r){return this._encrypt(t,r)}async secureOutbound(t,r){return this._encrypt(t,r)}async _encrypt(t,r){let n=t.log?.newScope("plaintext")??this.log,o=_i(t).pb(Lr);n("write pubkey exchange to peer %p",r?.remotePeer);let s=this.privateKey.publicKey;await o.write({id:s.toMultihash().bytes,pubkey:{Type:zt[s.type],Data:s.raw}},r);let i=await o.read(r),a;try{if(i.pubkey==null)throw new ie("Public key missing");if(i.pubkey.Data.byteLength===0)throw new ie("Public key data too short");if(i.id==null)throw new ie("Remote id missing");let c=Ei(i.pubkey.Data);if(a=vi(c),!it(a.toMultihash().bytes,i.id))throw new _e("Public key did not match id")}catch(c){throw n.error("invalid public key - %e",c),new _e(`Invalid public key - ${c.message}`)}if(r?.remotePeer!=null&&!a.equals(r?.remotePeer))throw new Je;return n("plaintext key exchange completed successfully with peer %p",a),{connection:o.unwrap().unwrap(),remotePeer:a}}};function yu(){return e=>new xo(e)}return Ci(bu);})();
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/utils.js:
@noble/curves/abstract/modular.js:
@noble/curves/abstract/curve.js:
@noble/curves/abstract/edwards.js:
@noble/curves/ed25519.js:
@noble/curves/abstract/weierstrass.js:
@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PPlaintext}));
//# sourceMappingURL=index.min.js.map
